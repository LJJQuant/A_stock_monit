# A股量化预警系统开发计划

## 一、项目概述

构建 A股主板+创业板 的量化预警系统：
- **实时预警**：盘中监控，满足条件推送钉钉 + Web展示
- **历史回测**：基于30分钟K线验证策略

## 二、技术选型

| 层级 | 技术 | 说明 |
|------|------|------|
| 语言 | Python 3.11+ | 类型注解 |
| 数据库 | DuckDB | 列式存储、向量化查询 |
| 数据处理 | Pandas + NumPy | 向量化计算 |
| 行情接口 | 掘金量化SDK | 历史下载 + 实时推送 |
| 爬虫 | httpx | 筹码、主力资金 |
| Web框架 | FastAPI | 预警API |
| 推送 | 钉钉机器人 | Webhook |
| 配置 | dataclass + YAML | 类型安全 |

## 三、数据存储

```
data/duckdb/
├── daily_kline.duckdb   # 日K线数据
├── stock_meta.duckdb    # 股票元信息、交易日历
├── realtime.duckdb      # 筹码、资金流、预警记录
└── backtest.duckdb      # 30分钟K线
```

## 四、分阶段计划

### Phase 1：基础设施
- 目录结构 + 依赖
- 配置管理（config.py + settings.yaml）
- 常量定义（constants.py）
- 数据库管理（db.py）
- 数据库初始化（建表脚本）

### Phase 2：数据层
- 掘金SDK封装
- 股票池获取（主板+创业板筛选）
- 日线数据下载与存储
- 30分钟K线下载

### Phase 3：指标与条件计算
- KDJ、MA、VWAP 指标计算
- 20个预警条件实现
- 信号引擎整合

### Phase 4：爬虫模块
- 筹码集中度爬虫
- 主力资金爬虫
- 条件18-19实现

### Phase 5：实时预警引擎
- 实时监控主循环
- 钉钉推送
- FastAPI接口
- 预警去重

### Phase 6：回测引擎
- 回测引擎核心
- 统计指标计算
- 回测报告

### Phase 7：Web界面
- 实时预警展示
- 历史查询
- 回测结果展示

## 五、20个预警条件

| 条件 | 描述 | 数据依赖 |
|------|------|----------|
| 1 | J < 98 且 今日J > 昨日J | 日线OHLC |
| 2 | 连续3天 J < K | 日线OHLC |
| 3 | 换手率倍数 ∈ [1.28, 12] | 换手率 |
| 4 | 当日换手率 ∈ [3.28%, 25.8%] | 换手率 |
| 5 | 隔日换手率 > 昨日 或 > 2.5 | 换手率 |
| 6 | 流通市值 ∈ [16亿, 500亿] | 流通市值 |
| 7 | 成交额 ∈ [1.68亿, 36.68亿] | 成交额 |
| 8 | 获利筹码 > 78% | 爬虫 |
| 9 | 前6或7天涨幅 < 11% | 收盘价 |
| 10 | 当日涨幅 ∈ [4%, 9.5%] | 实时价 |
| 11 | 当前价/均价 < 4% | 实时价+VWAP |
| 12 | 当前价 = 10日最高 | 实时价+历史high |
| 13 | 价格>MA60, MA5>MA20, MA5>MA60 | 收盘价 |
| 14 | 连续5日涨幅均 < 9.5% | 收盘价 |
| 15 | 不能出现4连阳 | OHLC |
| 16 | 10日内无大跌 > -8% | OC |
| 17 | 前2日无 > 4%上影阳线 | OHLC |
| 18 | 筹码集中度 > 昨日 | 爬虫 |
| 19 | 当日增仓比例 > 6% | 爬虫 |
| 20 | 尾盘30分钟条件 | 30分钟成交额 |

## 六、开发优先级

Phase 1 → 2 → 3 → 4 → 5 → 6 → 7

建议：先跑通 1-3（不含爬虫条件），再并行开发爬虫，最后实时预警和回测。
